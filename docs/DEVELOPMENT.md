# راهنمای توسعه پروژه Passage

## معماری پروژه

پروژه Passage از معماری Serverless استفاده می‌کند و بر روی Cloudflare Workers اجرا می‌شود. این پروژه شامل مولفه‌های زیر است:

1. **Worker (worker.js)**: منطق اصلی برنامه و APIها
2. **Frontend (HTML/CSS/JS)**: رابط کاربری وب
3. **KV Storage**: ذخیره‌سازی داده‌ها

## راه‌اندازی محیط توسعه

### پیش‌نیازها
- Node.js (نسخه 14 یا بالاتر)
- npm (معمولاً با Node.js نصب می‌شود)
- حساب Cloudflare

### نصب Wrangler
```bash
npm install -g wrangler
```

### ورود به حساب Cloudflare
```bash
wrangler login
```

### نصب وابستگی‌ها
```bash
npm install
```

## توسعه محلی

برای اجرای پروژه به صورت محلی:
```bash
wrangler dev
```

## استقرار

برای استقرار پروژه:
```bash
wrangler publish
```

## ساختار فایل‌ها

```
passage/
├── worker.js          # منطق اصلی Worker
├── index.html         # صفحه ورود
├── dashboard.html     # داشبورد اصلی
├── css/
│   └── style.css      # استایل‌های اصلی
├── js/
│   ├── login.js       # منطق صفحه ورود
│   ├── dashboard.js   # منطق داشبورد
│   └── i18n.js        # سیستم چندزبانه
├── test/
│   └── worker.test.js # تست‌های خودکار
├── docs/
│   ├── API.md         # مستندات API
│   └── DEVELOPMENT.md # راهنمای توسعه
├── package.json       # وابستگی‌ها و اسکریپت‌ها
└── wrangler.toml      # پیکربندی Worker
```

## APIها

مستندات کامل APIها در فایل [API.md](API.md) موجود است.

## تست‌ها

برای اجرای تست‌ها:
```bash
npm test
```

## استانداردهای کدنویسی

### JavaScript
- استفاده از async/await برای عملیات ناهمزمان
- مدیریت مناسب خطاها
- اعتبارسنجی ورودی‌ها
- مستندسازی توابع با JSDoc

### امنیت
- ذخیره نکردن توکن‌ها در localStorage
- استفاده نکردن از wildcard در CORS
- اعتبارسنجی تمام ورودی‌ها

## به‌روزرسانی مستندات

تمام مستندات باید با کد همگام‌سازی شوند. هر زمان که تغییری در APIها یا ساختار پروژه ایجاد کردید، مستندات مربوطه را نیز به‌روزرسانی کنید.

## مشکلات شناخته‌شده

1. KV Storage دارای محدودیت‌هایی در حجم داده و تعداد درخواست‌ها است
2. عدم وجود تست‌های خودکار برای رابط کاربری
3. نیاز به بهبود در مدیریت خطاها

## راهنمای عیب‌یابی

### خطاهای CORS
- مطمئن شوید که تنظیمات CORS به درستی انجام شده است
- بررسی کنید که دامنه‌های مجاز به درستی تنظیم شده‌اند

### خطاهای احراز هویت
- بررسی کنید که توکن‌ها به درستی ایجاد و ذخیره می‌شوند
- مطمئن شوید که زمان انقضای توکن‌ها به درستی تنظیم شده است

### خطاهای KV Storage
- بررسی کنید که KV namespaces به درستی پیکربندی شده‌اند
- مطمئن شوید که شناسه‌های KV namespace در فایل wrangler.toml صحیح هستند